<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>&nbsp;Nathan Baker&nbsp;&nbsp;//&nbsp;&nbsp;Rocket League AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600">
    <link rel="stylesheet" href="/styles.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <meta name="theme-color" content="#ffffff">
</head>

<body>
    <nav>
        <a href="/" class="black no-underline">
            <h1 class="center">
                <text class="pink mono">nathan</text><text class="black mono">.</text><text
                    class="red mono">baker</text><text class="black mono">() {</text>
            </h1>
        </a>
        <ul>
            <li><a class="gray mono" href="/portfolio">portfolio:</a></li>
            <li><a class="black bold mono" href="/code">code</a></li>
            <li><a class="gray mono" href="/photo">photo</a></li>
            <li><a class="gray mono" href="/video">video</a></li>
        </ul>
    </nav>
    <div>
        <div class="link-container" style="margin: -0.5rem;"></div>
        <h2 class="black center source-600">Rocket League AI</h2>
        <p class="black source">
            By far the biggest programming project that I've pursued outside of school has been creating a bot
            that can learn to play Rocket League by analyzing replays of human gameplay.
            <br>
        </p>
        <iframe src="https://www.youtube.com/embed/-928X5gDjzc?rel=0&modestbranding=1" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
        <p class="label source center">
            A <span class="image-desktop">close</span> match between my bot and a Psyonix Rookie bot.
        </p>
        <p class="black source">
            Rocket League is a competitive physics-based game of car soccer with a very high skill ceiling.
            Even experienced players struggle to perform well consistently, which is one reason why the
            vast majority of bot creators opt for defined routines rather than machine learning. When I started, I was
            not aware that many brilliant members of the <a class="black gray-hover"
                href="https://rlbot.org/"><u>RLBot</u></a> community
            had already attempted this and concluded that human replay data is not sufficient for model training.
            <br><br>
            Thus, I began writing my own scripts to collect and process thousands of publicly available replay files,
            and after months of programming and tinkering with neural networks, I feel I have seen some encouraging
            results. So this is where I will try to explain the approach I took, documenting my failures, successes, and
            work that remains to be done.
            <br>
            <!-- <div class="table-of-contents">
            <div class="black source-400">Table of Contents:&nbsp;&nbsp;</div>
            <div>
                &nbsp;&nbsp;<a class="black source gray-hover" href="javascript:scroll('collection');"><u>Data
                        Collection</u></a><br class="image-mobile">
                &nbsp;&nbsp;<a class="black source gray-hover" href="javascript:scroll('processing')"><u>Replay
                        Processing</u></a><br class="image-mobile">
                &nbsp;&nbsp;<a class="black source gray-hover" href="javascript:scroll('training')"><u>Model
                        Training</u></a><br class="image-mobile">
                &nbsp;&nbsp;<a class="black source gray-hover" href="javascript:scroll('thoughts')"><u>Thoughts
                    </u></a><br class="image-mobile">
            </div>
        </div> -->
        <p class="source-400">If you want to skip straight to the code, you can find it in
            <a class="black gray-hover" target="_blank" href="https://github.com/naynaybakebake/rocket_league_ai">
                <u>this repository</u></a>.
        </p>
        </p>
        <div class="link-container" id="collection" style="margin-bottom: -1rem; margin-top: 2rem;"></div>
        <h3 class="black center source-400">Data Collection</h3>
        <p class="black source">
            Initially, my ambitous self wanted to gather as many of my own replays as I could. I wanted a bot that could
            perform at the rank of Grand Champion. However, I quickly realized a problem. Whenever the bot ends up
            making a poor decision [<em>which is inevitable</em>], it will likely end up in a situation that a Grand
            Champ player would never find himself in, and thus it would struggle to recover. This sort of scenario
            occurred in the above video, at around the 6:40 mark. It drives too far into the goal and lands
            awkwardly. It happens. The problem is that it then spends a lot of time powersliding for no apparent reason,
            rather than defending.
            <br><br>
            To limit this sort of thing, I saw two necessary changes. First, I needed as much data as possible. The more
            matches at our disposal, the more situations we are able to recover from. Secondly, I decided to lower my
            standards and gather replays from a much lower rank set like silver. I figured that the increase in
            diversity would be worth the additional player mistakes.
            <br><br>
            The obvious source of this data would be
            <a class="black gray-hover" target="_blank" href="https://ballchasing.com"><u>ballchasing.com</u></a>,
            where users can upload their replays for future analysis. Using the API, I discovered that hundreds of
            silver 1v1 matches were being added every day, and I wrote a couple Python scripts to download them
            automatically until reaching the hourly limit. Currently I have just over 15,000 replay files stored on a
            dedicated microSD card.
            <br><br>
        </p>
        <div class="link-container" id="processing" style="margin-bottom: -1rem; margin-top: 2rem;"></div>
        <h3 class="black center source-400">Replay Processing</h3>
        <p class="black source">
            Next came the very important step of figuring out what data I needed and how to extract it. I could not make
            any sense of the replay file format, but thankfully there are people who've made parsers like
            <a class="black gray-hover" target="_blank" href="https://github.com/tfausak/rattletrap">
                <u>Rattletrap</u>
            </a>
            that convert them to javascript object notation. Slowly but surely, I learned how things were represented
            and developed additional Python scripts to organize the data with class structures and arrays.
            <br><br>
            It was at this point that I realized how limited the replays actually are. The data is saved at a
            resolution of 30 frames per second, which might be acceptable if every frame actually contained all the
            physics data. Unfortunately, one car may have a new rigid_body_state defined at frame 189, while the other
            car does not. These gaps presented a <big></big> problem that I tried to resolve with simple linear
            interpolation [<em>which became difficult to wrap my head around when it came to quaternions and rotation
                matrices</em>].
            <br><br>
            The next great obstacle came when discovering that replays do not actually contain all the controller inputs
            from the player. I found the data for boost, jump, steering, and throttle &mdash; everything was going well.
            I just needed to find the roll, pitch, and yaw inputs for aerials. Turns out those don't exist. But
            <a href="https://samuelpmish.github.io/notes/RocketLeague/aerial_control_inverse/" target="_blank"
                class="black gray-hover"><u>Sam Mish</u>
            </a>
            figured out a way to solve for those inputs based on the change in angular velocities. I was able to
            implement his solution and test it in Rocket League by giving a bot a list of inputs to follow and seeing if
            they matched the replay. It wasn't perfect, but maybe it would be good enough. I wanted to get on with
            training.
            <br><br>
        </p>
        <div class="link-container" id="training" style="margin-bottom: -1rem; margin-top: 2rem;"></div>
        <h3 class="black center source-400">Model Training</h3>
        <p class="black source">
            explain why i am using 92 inputs and 7 outputs per frame,
            combining boolean and analog losses and activations,
            the challenge of loading the dataset in ram,
            the issue of averaging out two very different decisions,
            weighting different outputs and classes,
            very different results from model to model, don't remember best hyperparameters, long training time.
            <br><br>
        </p>
        <div class="link-container" id="thoughts" style="margin-bottom: -1rem; margin-top: 2rem;"></div>
        <h3 class="black center source-400">Thoughts</h3>
        <p class="black source">
            Still lost to the easiest bot in Rocket League.
            Not as effective as the ML bots that were trained on other bots.
            Improvements?
            Steering very important. Need to find better ways to fill in gaps.
            Refine physics reconstruction altogether. Want to get bot_scripted to match replay very closely.
            I think the model can get more out of current dataset.
            Can play around more with network size, variable weights.
            <br><br>
        </p>
        <p class="source center gray">4 February 2021</p>
    </div>

    <script>
        const iframes = document.getElementsByTagName("iframe");
        for (let iframe of iframes) {
            iframe.style.opacity = "0";
            if (!iframe.complete) {
                iframe.addEventListener("load", fadeImg);
            } else {
                f = fadeImg.bind(iframe);
                f();
            }
        }

        function fadeImg() {
            this.style.transition = "opacity 1s";
            this.style.opacity = "1";
        }

        function scroll(id) {
            document.getElementById(id).scrollIntoView({
                behavior: "smooth"
            });
        }

    </script>

</body>

<footer>
    <h1 style="float:left;" class="black mono left closing-brace">}</h1>
    <ul class="footer-list footer-links">
        <li class="link-item"><a href="mailto:nathan.t.baker@okstate.edu">
                <img src="/assets/links/email.png"></a>
        </li>
        <li class="link-item"><a target="_blank" href="https://linkedin.com/in/nathan-baker-16173b1b8/">
                <img src="/assets/links/linkedin.png"></a>
        </li>
        <li class="link-item"><a target="_blank" href="https://instagram.com/naynaybakebake/">
                <img src="/assets/links/instagram.png"></a>
        </li>
        <li class="link-item"><a target="_blank" href="https://youtube.com/channel/UCDMhU58fPfb7kqvJJNVgU5w">
                <img src="/assets/links/youtube.png"></a>
        </li>
        <li class="link-item"><a target="_blank" href="https://open.spotify.com/user/naynaybakebake">
                <!-- href="https://open.spotify.com/playlist/4R078kIVCSGotunr22shUT?si=1fcad2dd6d1d49e3" -->
                <img src="/assets/links/spotify.png">
            </a>
        </li>
        <li class="link-item"><a target="_blank" href="https://github.com/naynaybakebake">
                <img src="/assets/links/github.png"></a>
        </li>
    </ul>
    <p class="footer-copyright gray mono">
        <text class="gray">Copyright &copy;</text>
        <text class="gray">2021</text>
        <text class="gray image-desktop">//</text>
        <br class="image-mobile">
        <a href="/" class="red">Nathan Baker</a>
    </p>
</footer>

</html>